# 03. トラブルシューティングとTDD実践

## 概要
実際の動作テストで発見された問題と、TDD原則に基づく解決プロセス

## 重要な学び: TDDの重要性

### 問題のあった開発プロセス
1. ❌ **API単体テストのみで「完成」と報告**
2. ❌ **ブラウザでの実際の動作確認を省略**
3. ❌ **コンソールエラーの軽視**
4. ❌ **ユーザー体験の確認不足**

### 改善されたTDD プロセス
1. ✅ **Red**: 失敗するテストを最初に作成
2. ✅ **Green**: テストを通すための最小実装
3. ✅ **Refactor**: 動作を保ちながら改善
4. ✅ **Integration**: 実際のユーザー操作で確認

## 発見・解決した技術問題

### 1. TailwindCSS ビルドエラー
```
Error: PostCSS plugin has moved to a separate package
```
**原因**: TailwindCSS v4の仕様変更
**解決**: `@tailwindcss/postcss` パッケージ導入

### 2. CORS プリフライトリクエストエラー  
```
Access to fetch blocked by CORS policy: No 'Access-Control-Allow-Origin' header
OPTIONS /api/chat HTTP/1.1 400 Bad Request
```
**原因**: FastAPIがOPTIONSメソッドを適切に処理していない
**解決**: CORSミドルウェアでOPTIONSメソッド明示的許可

### 3. 文脈認識の不完全性
```
入力: "こんにちわ" 
出力: "それいいアイデアだべ〜！" (意味不明)
```
**原因**: パターンマッチングの柔軟性不足（「こんにちは」vs「こんにちわ」）
**状況**: 技術的通信は成功、応答品質は次フェーズで改善予定

## 導入したテスト戦略

### 1. 統合テストスクリプト
```python
# simple_test.py
- Backend API 接続テスト
- Frontend 可用性テスト  
- CORS 動作テスト
```

### 2. 実ブラウザテスト
- UI要素の表示確認
- コンソールエラー監視
- 実際のユーザー操作フロー

### 3. エラー対応プロセス文書化
- 問題の根本原因分析
- 再発防止策の明文化
- TDD原則のCLAUDE.mdへの記載

## 完成条件の再定義

### 旧定義（不適切）
- ✅ APIが応答する
- ✅ コードにエラーがない

### 新定義（TDD準拠）
- ✅ 全自動テストがパス
- ✅ 実際のブラウザで正常動作
- ✅ コンソールエラー・警告ゼロ
- ✅ ユーザーが期待する動作を実現

## 得られた教訓
1. **APIテスト ≠ ユーザーテスト**: 表面的確認の危険性
2. **エラーは教師**: 問題発見こそが進歩の機会
3. **実ユーザー確認の価値**: しゅんぺいの実際操作が真の品質検証
4. **TDD は面倒だが不可欠**: 短期的面倒 < 長期的品質

## 次のステップへの影響
- Claude API統合時も同様のTDDプロセスを適用
- 各機能実装前に失敗するテストを作成
- ユーザー体験を最初から考慮した設計